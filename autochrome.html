<!DOCTYPE html>
<html><head><title>Autochrome - Structural diffs for Clojure source code</title><style>body {
  background: #000000;
  font-family: "Iosevka Term", "Fira Code", Inconsolata, Menlo, Monaco, Consolas, monospace;
  font-size: 16px;
}

a {
  text-decoration: none;
  font-weight: bolder;
}

code, pre {
  line-height: 1.24;
  font-family: "Iosevka Term", "Fira Code", Inconsolata, Menlo, Monaco, Consolas, monospace;
  word-break: normal;
  white-space: pre;
  word-spacing: normal;
  word-wrap: normal;
  background: #000000;
  color: #ffffff;
  hyphens: none;
}

code, a {
  text-decoration: none;
  font-weight: bolder;
  color: inherit;
}

pre {
  margin: 0px;
  overflow: auto;
  border-radius: 0.3em;
  font-weight: normal;
  overflow-y: hidden;
}

.gutter {
  text-align: right;
  padding-right: 4px;
  padding-left: 2px;
}

.code-card {
  margin-buttom: 16px;
  padding: 6px 6px 0px 6px;
  color: #ae81ff;
  font-weight: bold;
}

.code-card-heading {
  background: linear-gradient(#632697, #000);
  font-size: 22px;
  display: flex;
  justify-content: space-between;
}

.filename-heading {
  background: linear-gradient(#632697, #000);
  font-size: 22px;
  color: white;
}

.spacer {
  margin-bottom: 30px;
}

.code-card-heading-extra {
  display: flex;
}

.container {
  display: flex;
  flex-direction: row;
}

.usages {
  font-size: 16px;
  margin: auto;
}

.top-comment {
  margin-bottom: 17px;
}

.ns-ref {
  color: #f0c674;
}

.keyword {
  color: #8abeb7;
}

.var-ref {
  color: #81a2be;
}

.clojure-core {
  font-weight: bolder;
  color: #81a2be;
}

.macro {
  color: #b294bb;
}

.punctuation {
  color: #a6a6a0;
}

.ns-ref {
  color: #f0c674;
}

.string {
  color: #b5bd68;
}

.keyword {
  color: #70c0b1;
}

.meta > .keyword {
  color: #ea731c;
}

.java-class {
  color: #de9f25;
}

.punctuation {
  color: #a6a6a0;
}

.highlight {
  background-color: #5d007a;
}

.unparsed {
  background-color: #ff0000;
}

.added {
  background-color: #225d2d;
}

.deleted {
  background-color: rgba(200, 38, 38, 0.81);
}

.deleted .deleted {
  background-color: unset;
}

.added .added {
  background-color: unset;
}

.first-seen {
  text-decoration: underline;
}

.comment {
  color: #969896;
  font-style: italic;
  font-weight: normal;
}

.diffpane {
  width: 50%;
}

.shead {
  background-color: #1224b1;
  border-radius: 10px;
}

.thead {
  background-color: #5d007a;
  border-radius: 10px;
}</style><style>body {
  color: white;
}

p, .caption {
  font-family: sans-serif;
  text-align: left;
  font-size: 18px;
}

.caption {
  font-size: 14px;
}

p {
  text-indent: 2em;
}

.diffpane {
  width: unset;
}

.text {
  font-family: sans-serif;
}

.textcontainer {
  width: 67%;
  font-size: 18px;
}

.title {
  font-size: 32px;
}

.sectiontitle {
  font-size: 24px;
  text-decoration: underline;
}

.insetcontainer {
  display: flex;
  justify-content: space-between;
}

.insetcenter {
  display: flex;
  justify-content: center;
}

.logside {
  width: 50%;
}

.inset {
  border: 2px solid;
  border-color: #969896;
  padding: 10px;
  display: flex;
}

.examplesection {
  font-size: 16px;
  width: 70%;
  margin: auto;
}

.fixed {
  font-family: monospace;
  background-color: #111;
}</style></head><body><div data-reactroot="" data-react-checksum="-201854422"><div class="filename-heading"><div class="title">Autochrome - Structural diffs for Clojure source code</div></div><div class="textcontainer" style="margin:auto;"><div style="margin-top:35px;"><div class="insetcenter"><div class="inset"><div style="display:flex;flex-direction:row;"><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="the absolute1"><div>1</div></a><a href="the absolute2"><div>2</div></a><a href="the absolute3"><div>3</div></a><a href="the absolute4"><div>4</div></a><a href="the absolute5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span class="deleted"><span>(<a href="https://clojuredocs.org/clojure.core/println"><span class="clojure-core">println</span></a> <span class="string">&quot;hello!&quot;</span>)</span></span>
  {<span class="keyword">:more</span> (<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)
   <span class="keyword">:less</span> (<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)})</pre></div></div></div><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="worst hack1"><div>1</div></a><a href="worst hack2"><div>2</div></a><a href="worst hack3"><div>3</div></a><a href="worst hack4"><div>4</div></a><a href="worst hack5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span><span class="added">(</span><span class="added">-&gt;</span> <span>{<span class="keyword">:more</span> <span>(<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)</span>
       <span class="keyword">:less</span> <span>(<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)</span>}</span>
      <span class="added"><span>(<a href="https://clojuredocs.org/clojure.core/assoc"><span class="clojure-core">assoc</span></a> <span class="keyword">:twice</span> <span>(<a href="https://clojuredocs.org/clojure.core/+"><span class="clojure-core">+</span></a> x x)</span>)</span></span><span class="added">)</span></span>)</pre></div></div></div></div></div></div></div><p><div><div class="sectiontitle">Abstract</div><p><a href="https://github.com/ladderlife/autochrome">Autochrome (repo here)</a> uses a full parse to highlight and structurally diff Clojure source code.  It aims to make the experience of reviewing Clojure code just as nice as writing it.  It takes the form of a command-line tool which generates diffs as static HTML: </p><div class="insetcenter"><div class="inset"><pre>$ lein run <i>owner</i> <i>repo</i> <i>num</i> -o diff.html<span class="comment">        # write a diff for a GitHub pull request</span>
$ lein run --token user:123abc <i>owner</i> <i>repo</i> <i>num</i><span class="comment"> # use supplied auth token for github api</span>
$ lein run ... --open<span class="comment">                         # try to open the diff in a browser</span>
$ lein uberjar<span class="comment">                          # create a standalone jar in target/ directory</span>
$ java -jar autochrome.jar <i>old-tree</i> <i>new-tree</i><span class="comment">  # run like git diff from your repo</span></pre></div></div><p>If generated from GitHub, the line numbers in Clojure diffs link back to the PR.  Bold symbols link to documentation.</p></div><div><div class="sectiontitle">Features</div><p><ul class="text"><li style="margin-bottom:30px;">Scope-aware highlighting (no regular expressions):<div class="insetcontainer"><div class="inset"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="more hacks1"><div>1</div></a><a href="more hacks2"><div>2</div></a><a href="more hacks3"><div>3</div></a><a href="more hacks4"><div>4</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/let"><span class="macro clojure-core">let</span></a> [keyword <span class="keyword">:hello/world</span>
      name (<a href="https://clojuredocs.org/clojure.core/name"><span class="clojure-core">name</span></a> keyword)
      [a b <span class="keyword">:as</span> vec] (<a href="https://clojuredocs.org/clojure.core/map"><span class="clojure-core">map</span></a> <a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> [1 2 3])]
  (<a href="https://clojuredocs.org/clojure.core/str"><span class="clojure-core">str</span></a> (<a href="https://clojuredocs.org/clojure.core/namespace"><span class="clojure-core">namespace</span></a> keyword) name))</pre></div></div></div><div style="width:100%;"></div></div></li><li style="margin-bottom:30px;">Structural diff which can cope with wrapping/stripping parens:<div class="insetcontainer"><div class="inset"><div style="display:flex;flex-direction:row;"><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="the absolute1"><div>1</div></a><a href="the absolute2"><div>2</div></a><a href="the absolute3"><div>3</div></a><a href="the absolute4"><div>4</div></a><a href="the absolute5"><div>5</div></a><a href="the absolute6"><div>6</div></a><a href="the absolute7"><div>7</div></a></code></pre><div style="width:1px;"></div><pre class="source">{<span class="keyword">:a</span> <span class="keyword">:really</span>
 <span class="keyword">:big</span> <span class="keyword">:thing</span>
 <span class="deleted"><span class="keyword">:these</span></span> <span class="deleted"><span class="keyword">:entries</span></span>
 <span class="keyword">:which</span> <span class="keyword">:is</span>
 <span class="deleted"><span class="keyword">:were</span></span> <span class="deleted"><span class="keyword">:removed</span></span>
 <span class="keyword">:very</span> <span class="keyword">:annoying</span>
 <span class="keyword">:to</span> <span class="keyword">:read</span>}</pre></div></div></div><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="worst hack1"><div>1</div></a><a href="worst hack2"><div>2</div></a><a href="worst hack3"><div>3</div></a><a href="worst hack4"><div>4</div></a><a href="worst hack5"><div>5</div></a><a href="worst hack6"><div>6</div></a><a href="worst hack7"><div>7</div></a><a href="worst hack8"><div>8</div></a></code></pre><div style="width:1px;"></div><pre class="source parens-added"><span><span class="added">(</span><span class="added">keys</span>
   <span><span class="added">(</span><span class="added">merge</span>
    <span>{<span class="keyword">:a</span> <span class="keyword">:really</span>
     <span class="keyword">:big</span> <span class="keyword">:thing</span>
     <span class="keyword">:which</span> <span class="keyword">:is</span>
     <span class="keyword">:very</span> <span class="keyword">:annoying</span>
     <span class="keyword">:to</span> <span class="keyword">:read</span>}</span>
    <span class="added"><span>{<span class="keyword">:more</span> <span class="keyword">:stuff</span>}</span></span><span class="added">)</span></span><span class="added">)</span></span></pre></div></div></div></div></div><div style="width:100%;"></div></div></li><li style="margin-bottom:30px;">Naturally, whitespace is ignored completely: (h/t <a href="http://blog.klipse.tech/lambda/2016/08/07/pure-y-combinator-clojure.html">@viebel</a>)<div class="insetcontainer"><div class="inset"><div style="display:flex;flex-direction:row;"><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="the absolute1"><div>1</div></a><a href="the absolute2"><div>2</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojure.org/reference/special_forms#def"><span class="macro clojure-core">def</span></a> Y(<a href="https://clojure.org/reference/special_forms#fn"><span class="macro clojure-core">fn</span></a>[f]((<a href="https://clojure.org/reference/special_forms#fn"><span class="macro clojure-core">fn</span></a>[x](x,x))
(<a href="https://clojure.org/reference/special_forms#fn"><span class="macro clojure-core">fn</span></a>[x](f(<a href="https://clojure.org/reference/special_forms#fn"><span class="macro clojure-core">fn</span></a>[y]((x,x),y)))))))</pre></div></div></div><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="worst hack1"><div>1</div></a><a href="worst hack2"><div>2</div></a><a href="worst hack3"><div>3</div></a><a href="worst hack4"><div>4</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojure.org/reference/special_forms#def"><span class="macro clojure-core">def</span></a> Y
  (<a href="https://clojure.org/reference/special_forms#fn"><span class="macro clojure-core">fn</span></a> [f]
    ((<a href="https://clojure.org/reference/special_forms#fn"><span class="macro clojure-core">fn</span></a> [x] (x x))
     (<a href="https://clojure.org/reference/special_forms#fn"><span class="macro clojure-core">fn</span></a> [x] (f (<a href="https://clojure.org/reference/special_forms#fn"><span class="macro clojure-core">fn</span></a> [y] ((x x) y)))))))</pre></div></div></div></div></div><div style="width:100%;"></div></div></li></ul></p></div><div><div class="sectiontitle">Misfeatures</div><p><ul class="text"><li>Symbols can only have one annotation.  (diff color overwrites highlight)</li><li>Terrible for viewing non-clojure diffs.  </li><li>Difficult to port to ClojureScript.  </li><li>Uses its own custom clojure parser.</li><li>Occasionally gets strange ideas.</li></ul></p></div><div><div class="sectiontitle">How it works</div><p>Structural diffing is something I always wanted for Clojure.  When I saw <a href="http://thume.ca/2017/06/17/tree-diffing/">Tristan Hume&#x27;s article about tree diffing</a>, I was inspired to give it a shot myself using the same A* pathfinding technique he described.  In order to apply A* to the problem of tree diffing, you need to extend the concepts of location, cost, distance, and adjacency to tree diffs.  Location is clearly needed to know where you are, but in addition they need to be comparable, so you know not to bother when you already have a better path to the same place.  Cost is what makes some paths preferred over others.  For pathfinding on a road network, this would be the total distance traveled along the roads used.  By &#x27;distance&#x27; I really mean the A* heuristic, which in the case of roads might be the straight-line distance to the destination.  Adjacency is what states are reachable from a particular state.  For roads you might say that intersections are the nodes and adjacency means there is a road connecting them.  In autochrome:<ul class="text"><li>Location is a pair of pointers into the source and target lists, plus the stack of previous locations.  Intuitively, the pointers represent a pair of &#x27;cursors&#x27; over the tree structure.  Without the stack of previous locations, comparison would break, since all locations at the end of two lists would be indistinguishable from the goal (the end of both root lists)</li><li>Cost is the total size of all subtrees added and deleted, plus the number of subtree added and deleted.  Subtree size is 1 for empty collections, character count for text nodes, and sum size of children for branch nodes.  The number of subtrees changed is included in the cost so that the algorithm prefers deleting/adding entirelists, rather than all their elements (since they have the same cost otherwise).</li><li>Distance is the maximum of the &quot;remaining&quot; tree sizes for the source and target tree.  Whenever a subtree is accounted for by being added, deleted, or matched with an identical subtree, its size is subtracted from the remaining size.</li><li>Adjacency is a bit complicated:<ul><li>When the source and target cursors are over identical subtrees, we always advance both cursors.</li><li>When the source cursor is not at the end of its list, we may advance it while keeping the same target cursor.  This corresponds to deleting a subtree from the source list.</li><li>Likewise for the target cursor: we advance it and keep the source cursor, corresponding to a subtree addition.</li><li>When both cursors are over matching collection types, we can move both cursors into the lists.  We also need to push the next location onto the stack.</li><li>When both cursors are nil, it means we have reached the end of both lists, and we need to pop the next location in the parent sequences off the stack.</li></ul><p>This is the basic version of adjacency that I started with.  However, when implemented this way, the algorithm cannot match subtrees at different levels of nesting, since the cursors always move up or down together.  To handle changes in nesting, the cursors need to be allowed to move up and down independently, like they are allowed to do within lists.  This means that instead of one stack of pairs of pointers, we need a pair of stacks of pointers, one per cursor.  Then we need to add some state transitions: </p><ul><li>When only the source cursor is nil, pop the source stack only.</li><li>Likewise for target cursor.</li><li>When the source cursor is over a branch node, move it to the first child, and push the next position on the source stack.</li><li>Likewise for target cursor.</li></ul><p>Since there are quite a lot of branch nodes, this creates a ton of extra states for the algorithm to explore.  So although it seems like the steps which move both cursors up/down would obsolete, since they can be replicated with two single-cursor movements, they are needed so that performance is not terrible on mostly identical subtrees (ie the common case).  It is also helpful to make single-cursor movement cost more than two-cursor movement, so that we only try a single-cursor move after matched movement fails.  The extra cost accounts for the fact that single-cursor movement corresponds to adding or removing a set of parens.</p></li></ul></p></div></p><div><div class="sectiontitle">Worked Example</div><p>I don&#x27;t know about you, but I&#x27;m not the type who can absorb the essence of a complicated algorithm from a wall of text as seen above.  So let&#x27;s look at a detailed log of all the states we popped from our A* priority queue while generating the example diff at the top of this page.  The states are numbered in the order in which they were explored, however I will only show the goal state and its predecessors,  starting from the initial state.</p></div></div><div class="examplesection"><div style="margin-bottom:40px;" class="insetcontainer"><div style="min-width:fit-content;min-width:-moz-fit-content;" class="inset"><div id="229289773"><div class="filename-heading"><span style="font-size:16px;">#000  -0,+0 cost 0/-92 remain 90/92</span></div><div style="display:flex;flex-direction:row;"><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="the absolute1"><div>1</div></a><a href="the absolute2"><div>2</div></a><a href="the absolute3"><div>3</div></a><a href="the absolute4"><div>4</div></a><a href="the absolute5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source shead"><span class="shead"><span>(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  <span>[x]</span>
  <span>(<a href="https://clojuredocs.org/clojure.core/println"><span class="clojure-core">println</span></a> <span class="string">&quot;hello!&quot;</span>)</span>
  <span>{<span class="keyword">:more</span> <span>(<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)</span>
   <span class="keyword">:less</span> <span>(<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)</span>}</span>)</span></span></pre></div></div></div><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="worst hack1"><div>1</div></a><a href="worst hack2"><div>2</div></a><a href="worst hack3"><div>3</div></a><a href="worst hack4"><div>4</div></a><a href="worst hack5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source thead"><span class="thead"><span>(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  <span>[x]</span>
  <span>(<a href="https://clojuredocs.org/clojure.core/-&gt;"><span class="macro clojure-core">-&gt;</span></a> <span>{<span class="keyword">:more</span> <span>(<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)</span>
       <span class="keyword">:less</span> <span>(<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)</span>}</span>
      <span>(<a href="https://clojuredocs.org/clojure.core/assoc"><span class="clojure-core">assoc</span></a> <span class="keyword">:twice</span> <span>(<a href="https://clojuredocs.org/clojure.core/+"><span class="clojure-core">+</span></a> x x)</span>)</span>)</span>)</span></span></pre></div></div></div></div></div></div><div></div><div class="logside"><div style="display:flex;height:100%;flex-direction:column;justify-content:center;"><div></div><div class="caption">The source cursor is blue, and the target cursor is purple.  As you can see, we start with each cursor over its entire subtree.  The header at the top shows information about the diff state:<ul><li><span class="fixed">-0,+0</span>  is the number of deletions and additions</li><li><span class="fixed">cost 0/-92</span>  is the heuristic cost / real cost.  Meaningless for start node.</li><li><span class="fixed">remain 90/92</span>  is the remaining cost of the source and target trees.</li></ul>Note that real cost = heuristic cost - max(source remaining, target remaining).  By heuristic cost, I mean the estimated total distance from the start to the goal, used as the key in the priority queue, or <i>g(n) + h(n)</i> in <a href="https://en.wikipedia.org/wiki/A*_search_algorithm#Description">typical A* notation.  </a></div></div></div></div><div style="margin-bottom:40px;" class="insetcontainer"><div style="min-width:fit-content;min-width:-moz-fit-content;" class="inset"><div id="1896169729"><div class="filename-heading"><span style="font-size:16px;">#003  -0,+0 cost 93/1 remain 90/92</span></div><div style="display:flex;flex-direction:row;"><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="the absolute1"><div>1</div></a><a href="the absolute2"><div>2</div></a><a href="the absolute3"><div>3</div></a><a href="the absolute4"><div>4</div></a><a href="the absolute5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<span class="shead">defn</span> example
  [x]
  (<a href="https://clojuredocs.org/clojure.core/println"><span class="clojure-core">println</span></a> <span class="string">&quot;hello!&quot;</span>)
  {<span class="keyword">:more</span> (<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)
   <span class="keyword">:less</span> (<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)})</pre></div></div></div><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="worst hack1"><div>1</div></a><a href="worst hack2"><div>2</div></a><a href="worst hack3"><div>3</div></a><a href="worst hack4"><div>4</div></a><a href="worst hack5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<span class="thead">defn</span> example
  [x]
  (<a href="https://clojuredocs.org/clojure.core/-&gt;"><span class="macro clojure-core">-&gt;</span></a> {<span class="keyword">:more</span> (<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)
       <span class="keyword">:less</span> (<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)}
      (<a href="https://clojuredocs.org/clojure.core/assoc"><span class="clojure-core">assoc</span></a> <span class="keyword">:twice</span> (<a href="https://clojuredocs.org/clojure.core/+"><span class="clojure-core">+</span></a> x x))))</pre></div></div></div></div></div></div><div></div><div class="logside"><div style="display:flex;height:100%;flex-direction:column;justify-content:center;"><div></div><div class="caption">After we enter the main loop and pop the start state, we can start exploring.  In this state we have matched the parentheses and descended into the defn body. </div></div></div></div><div style="margin-bottom:40px;" class="insetcontainer"><div style="min-width:fit-content;min-width:-moz-fit-content;" class="inset"><div id="377257726"><div class="filename-heading"><span style="font-size:16px;">#006  -0,+0 cost 89/1 remain 86/88</span></div><div style="display:flex;flex-direction:row;"><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="the absolute1"><div>1</div></a><a href="the absolute2"><div>2</div></a><a href="the absolute3"><div>3</div></a><a href="the absolute4"><div>4</div></a><a href="the absolute5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> <span class="shead">example</span>
  [x]
  (<a href="https://clojuredocs.org/clojure.core/println"><span class="clojure-core">println</span></a> <span class="string">&quot;hello!&quot;</span>)
  {<span class="keyword">:more</span> (<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)
   <span class="keyword">:less</span> (<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)})</pre></div></div></div><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="worst hack1"><div>1</div></a><a href="worst hack2"><div>2</div></a><a href="worst hack3"><div>3</div></a><a href="worst hack4"><div>4</div></a><a href="worst hack5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> <span class="thead">example</span>
  [x]
  (<a href="https://clojuredocs.org/clojure.core/-&gt;"><span class="macro clojure-core">-&gt;</span></a> {<span class="keyword">:more</span> (<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)
       <span class="keyword">:less</span> (<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)}
      (<a href="https://clojuredocs.org/clojure.core/assoc"><span class="clojure-core">assoc</span></a> <span class="keyword">:twice</span> (<a href="https://clojuredocs.org/clojure.core/+"><span class="clojure-core">+</span></a> x x))))</pre></div></div></div></div></div></div><div></div><div class="logside"><div style="display:flex;height:100%;flex-direction:column;justify-content:center;"><div></div><div class="caption">We matched <span class="fixed">defn</span> with <span class="fixed">defn</span> and advanced both cursors. Now we can now match <span class="fixed">example</span> with <span class="fixed">example</span>.</div></div></div></div><div style="margin-bottom:40px;" class="insetcontainer"><div style="min-width:fit-content;min-width:-moz-fit-content;" class="inset"><div id="584325338"><div class="filename-heading"><span style="font-size:16px;">#007  -0,+0 cost 82/1 remain 79/81</span></div><div style="display:flex;flex-direction:row;"><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="the absolute1"><div>1</div></a><a href="the absolute2"><div>2</div></a><a href="the absolute3"><div>3</div></a><a href="the absolute4"><div>4</div></a><a href="the absolute5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  <span class="shead"><span>[x]</span></span>
  (<a href="https://clojuredocs.org/clojure.core/println"><span class="clojure-core">println</span></a> <span class="string">&quot;hello!&quot;</span>)
  {<span class="keyword">:more</span> (<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)
   <span class="keyword">:less</span> (<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)})</pre></div></div></div><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="worst hack1"><div>1</div></a><a href="worst hack2"><div>2</div></a><a href="worst hack3"><div>3</div></a><a href="worst hack4"><div>4</div></a><a href="worst hack5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  <span class="thead"><span>[x]</span></span>
  (<a href="https://clojuredocs.org/clojure.core/-&gt;"><span class="macro clojure-core">-&gt;</span></a> {<span class="keyword">:more</span> (<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)
       <span class="keyword">:less</span> (<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)}
      (<a href="https://clojuredocs.org/clojure.core/assoc"><span class="clojure-core">assoc</span></a> <span class="keyword">:twice</span> (<a href="https://clojuredocs.org/clojure.core/+"><span class="clojure-core">+</span></a> x x))))</pre></div></div></div></div></div></div><div></div><div class="logside"><div style="display:flex;height:100%;flex-direction:column;justify-content:center;"><div></div><div class="caption">Since matching is done with subtree hashes, we can match <span class="fixed">[x]</span> without going into the vector at all.</div></div></div></div><div style="margin-bottom:40px;" class="insetcontainer"><div style="min-width:fit-content;min-width:-moz-fit-content;" class="inset"><div id="2031340807"><div class="filename-heading"><span style="font-size:16px;">#008  -0,+0 cost 81/1 remain 78/80</span></div><div style="display:flex;flex-direction:row;"><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="the absolute1"><div>1</div></a><a href="the absolute2"><div>2</div></a><a href="the absolute3"><div>3</div></a><a href="the absolute4"><div>4</div></a><a href="the absolute5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span class="shead"><span>(<a href="https://clojuredocs.org/clojure.core/println"><span class="clojure-core">println</span></a> <span class="string">&quot;hello!&quot;</span>)</span></span>
  {<span class="keyword">:more</span> (<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)
   <span class="keyword">:less</span> (<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)})</pre></div></div></div><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="worst hack1"><div>1</div></a><a href="worst hack2"><div>2</div></a><a href="worst hack3"><div>3</div></a><a href="worst hack4"><div>4</div></a><a href="worst hack5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span class="thead"><span>(<a href="https://clojuredocs.org/clojure.core/-&gt;"><span class="macro clojure-core">-&gt;</span></a> <span>{<span class="keyword">:more</span> <span>(<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)</span>
       <span class="keyword">:less</span> <span>(<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)</span>}</span>
      <span>(<a href="https://clojuredocs.org/clojure.core/assoc"><span class="clojure-core">assoc</span></a> <span class="keyword">:twice</span> <span>(<a href="https://clojuredocs.org/clojure.core/+"><span class="clojure-core">+</span></a> x x)</span>)</span>)</span></span>)</pre></div></div></div></div></div></div><div></div><div class="logside"><div style="display:flex;height:100%;flex-direction:column;justify-content:center;"><div></div><div class="caption">Now we have our first mismatch.  We have a few options here:<ol><li>Delete source (blue) subtree</li><li>Add target (purple) subtree</li><li>Go into both subtrees</li><li>Go into blue subtree only</li><li>Go into purple subtree only</li></ol></div></div></div></div><div style="margin-bottom:40px;" class="insetcontainer"><div style="min-width:fit-content;min-width:-moz-fit-content;" class="inset"><div id="1713014249"><div class="filename-heading"><span style="font-size:16px;">#013  -0,+1 cost 83/3 remain 78/80</span></div><div style="display:flex;flex-direction:row;"><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="the absolute1"><div>1</div></a><a href="the absolute2"><div>2</div></a><a href="the absolute3"><div>3</div></a><a href="the absolute4"><div>4</div></a><a href="the absolute5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span class="shead"><span>(<a href="https://clojuredocs.org/clojure.core/println"><span class="clojure-core">println</span></a> <span class="string">&quot;hello!&quot;</span>)</span></span>
  {<span class="keyword">:more</span> (<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)
   <span class="keyword">:less</span> (<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)})</pre></div></div></div><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="worst hack1"><div>1</div></a><a href="worst hack2"><div>2</div></a><a href="worst hack3"><div>3</div></a><a href="worst hack4"><div>4</div></a><a href="worst hack5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span><span class="added">(</span><span class="thead">-&gt;</span> <span>{<span class="keyword">:more</span> <span>(<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)</span>
       <span class="keyword">:less</span> <span>(<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)</span>}</span>
      <span>(<a href="https://clojuredocs.org/clojure.core/assoc"><span class="clojure-core">assoc</span></a> <span class="keyword">:twice</span> <span>(<a href="https://clojuredocs.org/clojure.core/+"><span class="clojure-core">+</span></a> x x)</span>)</span><span class="added">)</span></span>)</pre></div></div></div></div></div></div><div></div><div class="logside"><div style="display:flex;height:100%;flex-direction:column;justify-content:center;"><div></div><div class="caption">We explore all of those options, but eventually we choose the last.  Since we moved the target cursor into a list while the source cursor stayed put, it follows that if we finish diffing, the parens which create that extra list must have been added, so we can go ahead and paint them green.</div></div></div></div><div style="margin-bottom:40px;" class="insetcontainer"><div style="min-width:fit-content;min-width:-moz-fit-content;" class="inset"><div id="1148288696"><div class="filename-heading"><span style="font-size:16px;">#020  -0,+2 cost 84/6 remain 78/78</span></div><div style="display:flex;flex-direction:row;"><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="the absolute1"><div>1</div></a><a href="the absolute2"><div>2</div></a><a href="the absolute3"><div>3</div></a><a href="the absolute4"><div>4</div></a><a href="the absolute5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span class="shead"><span>(<a href="https://clojuredocs.org/clojure.core/println"><span class="clojure-core">println</span></a> <span class="string">&quot;hello!&quot;</span>)</span></span>
  {<span class="keyword">:more</span> (<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)
   <span class="keyword">:less</span> (<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)})</pre></div></div></div><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="worst hack1"><div>1</div></a><a href="worst hack2"><div>2</div></a><a href="worst hack3"><div>3</div></a><a href="worst hack4"><div>4</div></a><a href="worst hack5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span><span class="added">(</span><span class="added">-&gt;</span> <span class="thead"><span>{<span class="keyword">:more</span> <span>(<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)</span>
       <span class="keyword">:less</span> <span>(<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)</span>}</span></span>
      <span>(<a href="https://clojuredocs.org/clojure.core/assoc"><span class="clojure-core">assoc</span></a> <span class="keyword">:twice</span> <span>(<a href="https://clojuredocs.org/clojure.core/+"><span class="clojure-core">+</span></a> x x)</span>)</span><span class="added">)</span></span>)</pre></div></div></div></div></div></div><div></div><div class="logside"><div style="display:flex;height:100%;flex-direction:column;justify-content:center;"><div></div><div class="caption">Add the <span class="fixed">-&gt;</span>.</div></div></div></div><div style="margin-bottom:40px;" class="insetcontainer"><div style="min-width:fit-content;min-width:-moz-fit-content;" class="inset"><div id="2109423643"><div class="filename-heading"><span style="font-size:16px;">#025  -1,+2 cost 100/22 remain 63/78</span></div><div style="display:flex;flex-direction:row;"><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="the absolute1"><div>1</div></a><a href="the absolute2"><div>2</div></a><a href="the absolute3"><div>3</div></a><a href="the absolute4"><div>4</div></a><a href="the absolute5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span class="deleted"><span>(<a href="https://clojuredocs.org/clojure.core/println"><span class="clojure-core">println</span></a> <span class="string">&quot;hello!&quot;</span>)</span></span>
  <span class="shead"><span>{<span class="keyword">:more</span> <span>(<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)</span>
   <span class="keyword">:less</span> <span>(<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)</span>}</span></span>)</pre></div></div></div><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="worst hack1"><div>1</div></a><a href="worst hack2"><div>2</div></a><a href="worst hack3"><div>3</div></a><a href="worst hack4"><div>4</div></a><a href="worst hack5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span><span class="added">(</span><span class="added">-&gt;</span> <span class="thead"><span>{<span class="keyword">:more</span> <span>(<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)</span>
       <span class="keyword">:less</span> <span>(<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)</span>}</span></span>
      <span>(<a href="https://clojuredocs.org/clojure.core/assoc"><span class="clojure-core">assoc</span></a> <span class="keyword">:twice</span> <span>(<a href="https://clojuredocs.org/clojure.core/+"><span class="clojure-core">+</span></a> x x)</span>)</span><span class="added">)</span></span>)</pre></div></div></div></div></div></div><div></div><div class="logside"><div style="display:flex;height:100%;flex-direction:column;justify-content:center;"><div></div><div class="caption">Now we enqueue this state, #25, where we delete <span class="fixed">(println &quot;hello&quot;)</span>.  Since it&#x27;s a relatively large subtree, deleting it has a high cost, so we actually spend a lot of time going through other states before it is finally popped.</div></div></div></div><div style="margin-bottom:40px;" class="insetcontainer"><div style="min-width:fit-content;min-width:-moz-fit-content;" class="inset"><div id="1995001487"><div class="filename-heading"><span style="font-size:16px;">#115  -1,+2 cost 82/22 remain 45/60 (nil S)</span></div><div style="display:flex;flex-direction:row;"><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="the absolute1"><div>1</div></a><a href="the absolute2"><div>2</div></a><a href="the absolute3"><div>3</div></a><a href="the absolute4"><div>4</div></a><a href="the absolute5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span class="deleted"><span>(<a href="https://clojuredocs.org/clojure.core/println"><span class="clojure-core">println</span></a> <span class="string">&quot;hello!&quot;</span>)</span></span>
  {<span class="keyword">:more</span> (<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)
   <span class="keyword">:less</span> (<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)})</pre></div></div></div><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="worst hack1"><div>1</div></a><a href="worst hack2"><div>2</div></a><a href="worst hack3"><div>3</div></a><a href="worst hack4"><div>4</div></a><a href="worst hack5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span><span class="added">(</span><span class="added">-&gt;</span> <span>{<span class="keyword">:more</span> <span>(<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)</span>
       <span class="keyword">:less</span> <span>(<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)</span>}</span>
      <span class="thead"><span>(<a href="https://clojuredocs.org/clojure.core/assoc"><span class="clojure-core">assoc</span></a> <span class="keyword">:twice</span> <span>(<a href="https://clojuredocs.org/clojure.core/+"><span class="clojure-core">+</span></a> x x)</span>)</span></span><span class="added">)</span></span>)</pre></div></div></div></div></div></div><div></div><div class="logside"><div style="display:flex;height:100%;flex-direction:column;justify-content:center;"><div></div><div class="caption">But once we do pop it, we can match the identical maps under the cursors.  Since the map was the last element in the source defn body, the source cursor has reached the end of its list, so there is nothing to highlight in blue and it says <span class="fixed">(nil S)</span> in the header.</div></div></div></div><div style="margin-bottom:40px;" class="insetcontainer"><div style="min-width:fit-content;min-width:-moz-fit-content;" class="inset"><div id="1340892127"><div class="filename-heading"><span style="font-size:16px;">#122  -1,+3 cost 83/37 remain 45/46 (nil S) (nil T)</span></div><div style="display:flex;flex-direction:row;"><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="the absolute1"><div>1</div></a><a href="the absolute2"><div>2</div></a><a href="the absolute3"><div>3</div></a><a href="the absolute4"><div>4</div></a><a href="the absolute5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span class="deleted"><span>(<a href="https://clojuredocs.org/clojure.core/println"><span class="clojure-core">println</span></a> <span class="string">&quot;hello!&quot;</span>)</span></span>
  {<span class="keyword">:more</span> (<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)
   <span class="keyword">:less</span> (<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)})</pre></div></div></div><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="worst hack1"><div>1</div></a><a href="worst hack2"><div>2</div></a><a href="worst hack3"><div>3</div></a><a href="worst hack4"><div>4</div></a><a href="worst hack5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span><span class="added">(</span><span class="added">-&gt;</span> <span>{<span class="keyword">:more</span> <span>(<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)</span>
       <span class="keyword">:less</span> <span>(<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)</span>}</span>
      <span class="added"><span>(<a href="https://clojuredocs.org/clojure.core/assoc"><span class="clojure-core">assoc</span></a> <span class="keyword">:twice</span> <span>(<a href="https://clojuredocs.org/clojure.core/+"><span class="clojure-core">+</span></a> x x)</span>)</span></span><span class="added">)</span></span>)</pre></div></div></div></div></div></div><div></div><div class="logside"><div style="display:flex;height:100%;flex-direction:column;justify-content:center;"><div></div><div class="caption">Add <span class="fixed">(assoc :twice (+ x x))</span>.  This is the last element in the current target sequence, so now we have <span class="fixed">(nil S)</span> and <span class="fixed">(nil T)</span>.  At this point the source stack is <span class="fixed">[nil]</span> and the target stack is <span class="fixed">[nil nil]</span>, so we have to do two steps where we pop both and then pop target only, but the order doesn&#x27;t matter.</div></div></div></div><div style="margin-bottom:40px;" class="insetcontainer"><div style="min-width:fit-content;min-width:-moz-fit-content;" class="inset"><div id="285875515"><div class="filename-heading"><span style="font-size:16px;">#125  -1,+3 cost 83/37 remain 45/46 (nil S) (nil T)</span></div><div style="display:flex;flex-direction:row;"><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="the absolute1"><div>1</div></a><a href="the absolute2"><div>2</div></a><a href="the absolute3"><div>3</div></a><a href="the absolute4"><div>4</div></a><a href="the absolute5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span class="deleted"><span>(<a href="https://clojuredocs.org/clojure.core/println"><span class="clojure-core">println</span></a> <span class="string">&quot;hello!&quot;</span>)</span></span>
  {<span class="keyword">:more</span> (<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)
   <span class="keyword">:less</span> (<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)})</pre></div></div></div><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="worst hack1"><div>1</div></a><a href="worst hack2"><div>2</div></a><a href="worst hack3"><div>3</div></a><a href="worst hack4"><div>4</div></a><a href="worst hack5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span><span class="added">(</span><span class="added">-&gt;</span> <span>{<span class="keyword">:more</span> <span>(<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)</span>
       <span class="keyword">:less</span> <span>(<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)</span>}</span>
      <span class="added"><span>(<a href="https://clojuredocs.org/clojure.core/assoc"><span class="clojure-core">assoc</span></a> <span class="keyword">:twice</span> <span>(<a href="https://clojuredocs.org/clojure.core/+"><span class="clojure-core">+</span></a> x x)</span>)</span></span><span class="added">)</span></span>)</pre></div></div></div></div></div></div><div></div><div class="logside"><div style="display:flex;height:100%;flex-direction:column;justify-content:center;"><div></div><div class="caption">In fact, since the stacks are not shown, we can&#x27;t even tell which order was taken.  In either case, from here we do whichever pop operation we didn&#x27;t just do. </div></div></div></div><div style="margin-bottom:40px;" class="insetcontainer"><div style="min-width:fit-content;min-width:-moz-fit-content;" class="inset"><div id="1028941406"><div class="filename-heading"><span style="font-size:16px;">#126 goal!  -1,+3 cost 83/37 remain 45/46 (nil S) (nil T)</span></div><div style="display:flex;flex-direction:row;"><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="the absolute1"><div>1</div></a><a href="the absolute2"><div>2</div></a><a href="the absolute3"><div>3</div></a><a href="the absolute4"><div>4</div></a><a href="the absolute5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span class="deleted"><span>(<a href="https://clojuredocs.org/clojure.core/println"><span class="clojure-core">println</span></a> <span class="string">&quot;hello!&quot;</span>)</span></span>
  {<span class="keyword">:more</span> (<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)
   <span class="keyword">:less</span> (<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)})</pre></div></div></div><div class="diffpane"><div class="code-card"><div class="code-card-heading"><div class="code-card-heading-extra"></div></div><div class="container"><pre class="gutter"><code class="punctuation"><a href="worst hack1"><div>1</div></a><a href="worst hack2"><div>2</div></a><a href="worst hack3"><div>3</div></a><a href="worst hack4"><div>4</div></a><a href="worst hack5"><div>5</div></a></code></pre><div style="width:1px;"></div><pre class="source">(<a href="https://clojuredocs.org/clojure.core/defn"><span class="macro clojure-core">defn</span></a> example
  [x]
  <span><span class="added">(</span><span class="added">-&gt;</span> <span>{<span class="keyword">:more</span> <span>(<a href="https://clojuredocs.org/clojure.core/inc"><span class="clojure-core">inc</span></a> x)</span>
       <span class="keyword">:less</span> <span>(<a href="https://clojuredocs.org/clojure.core/dec"><span class="clojure-core">dec</span></a> x)</span>}</span>
      <span class="added"><span>(<a href="https://clojuredocs.org/clojure.core/assoc"><span class="clojure-core">assoc</span></a> <span class="keyword">:twice</span> <span>(<a href="https://clojuredocs.org/clojure.core/+"><span class="clojure-core">+</span></a> x x)</span>)</span></span><span class="added">)</span></span>)</pre></div></div></div></div></div></div><div></div><div class="logside"><div style="display:flex;height:100%;flex-direction:column;justify-content:center;"><div></div><div class="caption">Now we have <span class="fixed">(nil S)</span> and <span class="fixed">(nil T)</span>, and both stacks will be empty, so we are done!</div></div></div></div></div></div></body></html>